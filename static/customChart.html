<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- TODO: get a real favicon -->
  <!--<link rel="icon" href="/static/favicon.ico">-->

  <title>P.A.W.S.</title>

  <!-- Bootstrap core CSS -->
  <link href="/static/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="/static/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="/static/dashboard.css" rel="stylesheet">

  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
  <script src="/static/assets/js/ie-emulation-modes-warning.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <!-- Highcharts -->
  <!--<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>-->
  <script src="/static/highcharts/highcharts.js"></script>
  <script src="/static/highcharts/highcharts-more.js"></script>
  <script src="/static/highcharts/modules/exporting.js"></script>

</head>

<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
          aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="/">P.A.W.S.</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/">Dashboard</a></li>
          <li><a href="#">Custom Graphs</a></li>
          <li><a href="#">Profile</a></li>
          <li><a href="#">Help</a></li>
        </ul>
        <form class="navbar-form navbar-right">
          <input type="text" class="form-control" id="searchbar" placeholder=" Search Dog Name">
          <button class="btn btn-round" type="button" onclick="search()">Search</button>
        </form>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <!--<div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
          <li class="active"><a href="/">Overview <span class="sr-only">(current)</span></a></li>
          <li><a href="customChart.html">Custom Graphs</a></li>
          <li><a href="#">Analytics</a></li>
          <li><a href="#">Export</a></li>
        </ul>
        <ul class="nav nav-sidebar">
          <li><a href="">Nav item</a></li>
          <li><a href="">Nav item again</a></li>
          <li><a href="">One more nav</a></li>
          <li><a href="">Another nav item</a></li>
          <li><a href="">More navigation</a></li>
        </ul>
        <ul class="nav nav-sidebar">
          <li><a href="">Nav item again</a></li>
          <li><a href="">One more nav</a></li>
          <li><a href="">Another nav item</a></li>
        </ul>
      </div>-->
      <div class="col-sm-9 col-sm-offset-0 col-md-10 col-md-offset-0 main" style ="padding-left: 20%;">
        <h1 class="page-header">Custom Graphs</h1>
        <div class="row">
          <button id='graphButton' class='btn btn-round' style='background:blue; color:yellow'><a type = 'button'  href="javascript:void(0)" onclick="document.getElementById('popup1').style.display='block'; document.getElementById('graphButton').style.display='none'"><font color="yellow">Make A Graph</font></a></button>
        </div>
        <div id="popup1" style='display:none'>
          <div class="popup">
            <h2>Choose the Graph Type</h2>
            <p class="close" onclick="reset()">Ã—</p>
            <div class="content">
              <div>
                <select id="mySelect" onchange="fieldcheck()" style="width: 25%">
                            <option value = "Select" selected>Select One</option>
                            <option value = "Bar">Bar</option>
                            <option value = "Pie">Pie</option>
                            <option value = "Line">Line</option>
                            <option value ="Change Over Time">Change Over Time</option>
                        </select>

                <select id="mySelect2" onchange="fieldcheck2()" style="display:none">
                            <option value = "Apple">Apple</option>
                            <option value = " Orange">Orange</option>
                            <option value = "Pineapple">Pineapple</option>
                            <option value ="Banana">Banana</option>
                        </select>

                <select id="mySelect3" onchange="fieldcheck3()" style="display:none">
                            <option value = "Apple">Apple</option>
                            <option value = " Orange">Orange</option>
                            <option value = "Pineapple">Pineapple</option>
                            <option value ="Banana">Banana</option>
                        </select>

                <select id="mySelect4" onchange="fieldcheck4()" style="display:none">
                            <option value = "Apple">Apple</option>
                            <option value = " Orange">Orange</option>
                            <option value = "Pineapple">Pineapple</option>
                            <option value ="Banana">Banana</option>
                        </select>


                <button onclick="generateGraph()">Create</button>
              </div>
            </div>
          </div>
        </div>
        <div class='row'>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <canvas id="mybarChart"></canvas>
          </div>
        </div>
      </div>

    </div>
  </div>






  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="/static/assets/js/vendor/jquery.min.js"><\/script>')</script>
  <script src="/static/dist/js/bootstrap.min.js"></script>
  <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
  <script src="/static/assets/js/vendor/holder.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="/static/assets/js/ie10-viewport-bug-workaround.js"></script>
  <script type="text/javascript" src="/static/charts.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
  <script src="/static/Chart.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <script>

      var string1 = '';
      var string2 = '';
      var searched = [];
      var lineChart;
      var isValidBar = false;
      var mybarChart;
      var mybarChart2;
      var barchoices3 = [];

      var barchoices1 = [{"value": "Raw Data", "text": "Raw Data"}, {"value": "Comparisons", "text": "Comparisons"}];
      var barchoices2 = [{"value": "Active", "text": "Active"}, {"value": "Awake", "text": "Awake"}, {"value": "Rest", "text": "Rest"}, {"value": "Total", "text": "Total"}];
      $.ajax({
                type: "GET",
                url: "/api/cached/data/filtered/dogs",
                async: true,
                datatype: 'json',
                success : function(data) {
                    string2 = data;
                }
            });

            function fieldcheck(){

               console.log("TEST");
               console.log(barchoices3);
                var temp = $("#mySelect option:selected").text();
                isValidbar = false;
                console.log(isValidBar);
                if(temp != "Select One") {
                    $('#mySelect2').show();
                    if(temp == "Bar"){
                        barOptions('#mySelect2', barchoices1);

                    } else if (temp == "Pie"){
                        barOptions('#mySelect2', barchoices1);

                    }
                }  else {
                  isValidBar = false;
                    $('#mySelect2').hide();
                    $('#mySelect3').hide();
                    $('#mySelect4').hide();

                }
            }

            function fieldcheck2(){
                var temp = $("#mySelect2 option:selected").text();
                var temp2 = $("#mySelect option:selected").text();

                if(temp != "Select One") {
                    $('#mySelect3').show();

                    if(temp == "Raw Data"){
                        if (temp2 == "Bar") {
                            isValidBar = false;
                              barOptions('#mySelect3', barchoices2);
                              $('#mySelect4').hide();
                              //isValidBar = true;
                        } else if (temp2 == "Pie") {
                            var j = 0;
                            string1 = string2;
                            for (var i = 0; i < string2.length; i++) {
                               helper = {"value": string1[i].name, "text": string1[i].name}
                               barchoices3[j] = helper;
                               j++;
                           }
                            isValidBar = false;
                              barOptions('#mySelect3', barchoices3);
                              $('#mySelect4').hide();
                        }

                    } else if(temp == "Comparisons"){
                        if (temp2 == "Bar") {
                            isValidBar = false;
                            $('#mySelect4').show();
                            barOptions('#mySelect3', barchoices2);
                            barOptions('#mySelect4', barchoices2);
                        } else if (temp2 == "Pie") {
                            var j = 0;
                            string1 = string2;
                            for (var i = 0; i < string2.length; i++) {
                               helper = {"value": string1[i].name, "text": string1[i].name}
                               barchoices3[j] = helper;
                               j++;
                           }
                           isValidBar = false;
                           $('#mySelect4').show();
                           barOptions('#mySelect3', barchoices3);
                           barOptions('#mySelect4', barchoices3);
                        }

                    }
                }  else {
                    $('#mySelect3').hide();
                    $('#mySelect4').hide();
                    isValidBar = false;

                }
            }

            function fieldcheck3(){
              var select1 = $("#mySelect2 option:selected").text();
              var temp = $("#mySelect3 option:selected").text();
              if(temp != "Select One") {
                    if(select1 == "Raw Data"){
                        isValidBar = true;
                    } else {
                      idValiBar = false;
                    }
                }  else {
                    isValidBar = false;

                }
            }

            function fieldcheck4(){
              var select1 = $("#mySelect2 option:selected").text();
              var temp = $("#mySelect4 option:selected").text();
              var temp1 = $("#mySelect3 option:selected").text();
              if(temp != "Select One" && temp != temp1 && temp1 != "Select One") {
                    if(select1 == "Comparisons"){
                        isValidBar = true;
                    } else {
                      idValiBar = false;
                    }
                }  else {
                    isValidBar = false;

                }
            }

            function barOptions(item, options){
                $(item).empty();
                $(item).append($('<option>', {
                        value: "Select" ,
                        text: "Select One"
                        }));
                for(var i = 0; i < options.length ; i ++){
                    $(item).append($('<option>', {
                        value: options[i].value ,
                        text: options[i].text
                        }));
                }
            }

            function generateGraph(){
                //mybarChart.destroy();

              if(isValidBar){
                console.log("generate graph here");
                name1 = $("#mySelect1 option:selected").text();
                //alert("test");
                var temp1 = $("#mySelect option:selected").text();
                console.log(temp1);
                //alert("test");
                if (temp1 == "Bar") {
                    var select1 = $("#mySelect2 option:selected").text();
                    if(select1 == "Raw Data"){
                      var type = $("#mySelect3 option:selected").text();
                      makeBar(string2, type);
                    }
                    if(select1 == "Comparisons"){
                        var typeA = $("#mySelect3 option:selected").text();
                        var typeB = $("#mySelect4 option:selected").text();
                        makeBar2(string2, typeA, typeB);
                    }

                } else if (temp1 == "Pie") {
                    var select1 = $("#mySelect2 option:selected").text();
                    if(select1 == "Raw Data"){
                      var type = $("#mySelect3 option:selected").text();
                      makePie(string2, type);
                    }
                    if(select1 == "Comparisons"){
                        var typeA = $("#mySelect3 option:selected").text();
                        var typeB = $("#mySelect4 option:selected").text();
                        makePie2(string2, typeA, typeB);
                    }
                }
              } else {
                alert("Must Set Up A Proper Graph");
              }
            }

            function reset(){
              document.getElementById('popup1').style.display='none';
              document.getElementById('graphButton').style.display='block';
              $('#mySelect2').hide();
              $('#mySelect').val('Select');
              $('#mySelect2').val('Select');
              $('#mySelect3').val('Select');
              $('#mySelect4').val('Select');
              $('#mySelect3').hide();
              $('#mySelect4').hide();
              isValdBar = false;
              fieldcheck();
              mybarChart.destroy();


            }

            function makeBar(data,type){
                        var arr = new Array();
                        var arr1 = new Array();
                        string1 = data/*.dogs*/;
                        //console.log(string1);
                        /*string1.sort = function(a, b){
                            return (getBarInfo(a,type)) - (getBarInfo(b,type));
                        };*/
                        var j = 0;
                        for (var i =0; i < string1.length; i++) {
                           arr[j] = string1[i].name;
                           console.log(string1[i].name);
                           var ratio = getBarInfo(string1[i], type);
                           arr1[j] = ratio;
                           j++;
                       };
                        var ctx = document.getElementById("mybarChart");
                        mybarChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                              labels: arr,
                              datasets: [{
                                label: type,
                                backgroundColor: "blue",
                                data: arr1
                              }]
                            },

                            options: {
                              scales: {
                                yAxes: [{
                                  ticks: {
                                    beginAtZero: true
                                  }
                                }]
                              }
                            }
                        });

                   }


                   function makeBar2(data,typeA, typeB){
                               var arr = new Array();
                               var arr1 = new Array();
                               var arr2 = new Array();
                               string1 = data/*.dogs*/;
                               //console.log(string1);
                               /*string1.sort = function(a, b){
                                   return (getBarInfo(a,type)) - (getBarInfo(b,type));
                               };*/
                               var j = 0;
                               for (var i =0; i < string1.length; i++) {
                                  arr[j] = string1[i].name;
                                  console.log(string1[i].name);
                                  var ratio = getBarInfo(string1[i], typeA);
                                  var ratio2 = getBarInfo(string1[i], typeB);
                                  arr1[j] = ratio;
                                  arr2[j] = ratio2;
                                  j++;
                              };

                               var ctx = document.getElementById("mybarChart");
                               mybarChart = new Chart(ctx, {
                                   type: 'bar',
                                   data: {
                                     labels: arr,
                                     datasets: [{
                                       label: typeA,
                                       backgroundColor: "blue",
                                       data: arr1
                                   },{
                                     label: typeB,
                                     backgroundColor: "red",
                                     data: arr2
                                   }]
                                   },

                                   options: {
                                     scales: {
                                       yAxes: [{
                                         ticks: {
                                           beginAtZero: true
                                         }
                                       }]
                                     }
                                   }
                               });
                          }

                          function makePie(data, dog){
                              var arr = new Array();
                              var arr1 = new Array();
                              string1 = data/*.dogs*/;
                              //console.log(string1);
                              /*string1.sort = function(a, b){
                                  return (getBarInfo(a,type)) - (getBarInfo(b,type));
                              };*/
                              var j = 0;
                              for (var i =0; i < string1.length; i++) {
                                 if (string1[i].name == dog) {
                                     console.log(string1[i].name);
                                     var data1 = getBarInfo(string1[i], "Rest");
                                     var data2 = getBarInfo(string1[i], "Active");
                                     var data3 = getBarInfo(string1[i], "Awake");
                                 }

                             };
                              var ctx = document.getElementById("mybarChart");
                              var myChart = new Chart(ctx, {
                                type: 'pie',
                                data: {
                                  labels: ["Rest", "Active", "Awake"],
                                  datasets: [{
                                    backgroundColor: [
                                      "#2ecc71",
                                      "#3498db",
                                      "#95a5a6"

                                    ],
                                    data: [data1, data2, data3]
                                  }]
                                }
                              });

                         }

                         function makePie2(data, dog1, dog2){
                             var arr = new Array();
                             var arr1 = new Array();
                             string1 = data/*.dogs*/;
                             //console.log(string1);
                             /*string1.sort = function(a, b){
                                 return (getBarInfo(a,type)) - (getBarInfo(b,type));
                             };*/
                             var j = 0;
                             for (var i =0; i < string1.length; i++) {
                                if (string1[i].name == dog1) {
                                    console.log(string1[i].name);
                                    var data1 = getBarInfo(string1[i], "Rest");
                                    var data2 = getBarInfo(string1[i], "Active");
                                    var data3 = getBarInfo(string1[i], "Awake");
                                }
                                if (string1[i].name == dog2) {
                                    console.log(string1[i].name);
                                    var data4 = getBarInfo(string1[i], "Rest");
                                    var data5 = getBarInfo(string1[i], "Active");
                                    var data6 = getBarInfo(string1[i], "Awake");
                                }

                            };
                             var ctx = document.getElementById("mybarChart");
                             var myChart = new Chart(ctx, {
                               type: 'pie',
                               data: {
                                 labels: ["Rest", "Active", "Awake"],
                                 datasets: [{
                                   backgroundColor: [
                                     "#2ecc71",
                                     "#3498db",
                                     "#95a5a6"

                                   ],
                                   data: [data1, data2, data3]
                                 }]
                               }
                             });
                             var ctx = document.getElementById("mybarChart");
                             var myChart = new Chart(ctx, {
                               type: 'pie',
                               data: {
                                 labels: ["Rest", "Active", "Awake"],
                                 datasets: [{
                                   backgroundColor: [
                                     "#2ecc71",
                                     "#3498db",
                                     "#95a5a6"

                                   ],
                                   data: [data4, data5, data6]
                                 }]
                               }
                             });

                        }


                   function getRest(dog){
                     return dog.rest;
                   }

                   function getBarInfo(dog,type){
                     if(type == 'Rest'){
                       return dog.rest;
                     } else if(type == 'Active'){
                       return dog.active;
                     } else if(type == 'Awake'){
                       return dog.awake;
                     } else if(type == 'Total'){
                       return dog.total;
                     }
                   }





          </script>

          </body>
        </html>
